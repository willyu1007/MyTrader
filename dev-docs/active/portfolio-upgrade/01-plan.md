# 01 Plan

> 以“依赖顺序”为主线：数据层 -> 流水层 -> 持仓引擎 -> 估值/收益 -> 分析 -> 再平衡 -> 报表。

## Phases（建议分期）
### Phase 0 - 定义语义与信息架构
- 目标：锁定顶层 Tabs、关键口径与“真相来源”策略（手工持仓 vs 流水推导）
- 产出：字段字典（成本/收益/公司行为/汇率）、Tab 结构与首屏信息架构

### Phase 1 - 数据层（Data）
- 标的注册表（symbol 为全局键）完善：name/market/currency/auto_ingest
- 行情管道：导入/拉取/自动拉取状态可见 + 数据新鲜度（as-of）
- 数据质量：缺失/过期/异常提示与修复路径

### Phase 2 - 流水层（Ledger）
- 交易流水：买卖、费用税费、分红、公司行为事件（最小可用集合）
- 现金流：入金/出金/余额变动与对账

### Phase 3 - 持仓引擎（Position Engine）
- 从流水推导“当前持仓/历史持仓”，支持手工调整作为补丁
- 成本法与已实现/未实现收益口径落地

### Phase 4 - 估值与收益率（Performance）
- 估值：按价格/汇率/公司行为口径统一
- 收益率：TWR/MWR（先定最小集合），支持区间/时间序列

### Phase 5 - 分析（Analytics）
- 归因：先做“贡献”，再扩展方法
- 风险与回撤：集中度、波动、最大回撤、风险规则命中

### Phase 6 - 目标配置与再平衡（Allocation）
- 目标配置、漂移、再平衡建议清单（含约束检查）

### Phase 7 - 报表（Reporting）
- 快照、导出、复盘归档（可复现参数与口径）

## Verification checklist
- [x] `pnpm typecheck` 通过
- [ ] 手工用例覆盖：无行情/部分行情/全行情、流水驱动持仓、公司行为、收益率与回撤
